---
import { getCollection } from "astro:content";
import { sortById } from "../../utils/sortById";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../constants";
import Head from "../../components/Head.astro";
import Header from "../../components/Header.astro";
import Pagination from "../../components/Pagination.astro";
import Footer from "../../components/Footer.astro";
import "../../styles/global.css";
import "../../styles/destination.css";

export async function getStaticPaths() {
    const allDestinations = await getCollection("destinations");
    const numberOfDestinations = allDestinations.length;

    return allDestinations.sort(sortById).map((destination, i) => ({
        params: {
            slug: destination.slug,
        },
        props: {
            destination,
            previousDestination: i === 0 ? allDestinations[numberOfDestinations - 1] : allDestinations[i - 1],
            nextDestination: i === numberOfDestinations - 1 ? allDestinations[0] : allDestinations[i + 1],
        },
    }));
}

const { destination, previousDestination, nextDestination } = Astro.props;
---

<html lang="en">
    <Head siteTitle={SITE_TITLE} siteDescription={SITE_DESCRIPTION} pageTitle={destination.data.title} />
    <body>
        <Header />
        <main>
            <div class="container mb-5">
                <h1 class="mb-5">{destination.data.title}</h1>
                <p class="mb-5">{destination.data.description}</p>
                <ul class="row ps-0">
                    {
                        destination.data.images.map(image => (
                            <li class="col-sm-6">
                                <img src={image.url} alt={image.alt} class="img-fluid w-100 mb-4" />
                            </li>
                        ))
                    }
                </ul>
                <Pagination previousElement={previousDestination} nextElement={nextDestination} />
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <Footer />
        </main>
    </body>
</html>
